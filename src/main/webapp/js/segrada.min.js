function escapeHTML(e){return"string"==typeof e?e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"):""}!function(s){function n(n){return function(e,t,a){s.ajax({url:n+encodeURIComponent(e)}).done(function(e){a(e)})}}function t(){return function(e,t,a){let n=urlSegradaNodeSearch+encodeURIComponent(e);const r=s(".sg-node-search").filter(":focus"),i=s("#"+r.attr("data-select-id")+" option").filter(":selected");e=i.attr(r.attr("data-attr"));null!=e&&0<e.length&&(n+="&tags="+encodeURIComponent(e));s.ajax({url:n}).done(function(e){a(e)})}}function e(e){return e.replace(/;jsessionid=([^?]*)/,"")}urlSegradaPictogramSearch=e(urlSegradaPictogramSearch),urlSegradaPictogramFile=e(urlSegradaPictogramFile),urlSegradaTagSearch=e(urlSegradaTagSearch),urlSegradaNodeSearch=e(urlSegradaNodeSearch),urlSegradaFileSearch=e(urlSegradaFileSearch),urlSegradaSourceSearch=e(urlSegradaSourceSearch),urlSegradaRelationAdd=e(urlSegradaRelationAdd);var r=!1,o=new vis.DataSet([]),l=new vis.DataSet([]),d=null,i=null,c=null;s.fn.onEnter=function(t){return this.bind("keypress",function(e){13==e.keyCode&&t.apply(this,[e])}),this};var u=new RegExp(/<([^\s]+).*?id="([^"]*?)".*?>/i);function a(r,t,i,o,e){e=urlSegradaPictogramSearch+encodeURIComponent(e);s.getJSON(e,function(e){var n=[];s.each(e,function(e,t){var a=s("<div/>").text(t.title).html();n.push('<div class="col-xs-1 sg-no-padding-right"><a class="sg-pictogram-modal-link" href="#" data-id="'+t.id+'" data-uid="'+t.uid+'" title="'+a+'"><img src="'+urlSegradaPictogramFile+t.uid+'" width="24" height="24" alt="'+a+'" /></a></div>')}),t.html("<div class='row'>"+n.join("")+"</div>"),s("a",t).click(function(e){var t=s(this).attr("data-id"),a=s(this).attr("data-uid"),n=s("<div/>").text(s(this).attr("title")).html();s("#value-"+i,o).val(t),s("#preview-"+i,o).html('<img src="'+urlSegradaPictogramFile+a+'" width="24" height="24" alt="'+n+'" /> '+n),s("#clear-"+i,o).show(),e.preventDefault(),r.modal("hide")})}).fail(function(){alert("ERROR")})}function h(e){s.get(e,function(e){var t=e.match(u);null!=t&&2<=t.length&&s("#"+t[2]).remove();t=s("#sg-data");t.prepend(e);t=t.children(":first");g(t),s("html, body").animate({scrollTop:t.offset().top},500)}).fail(function(){alert("ERROR")})}function g(o){o=o||s("body"),s(".sg-data").addClass("sg-dynamic-data"),s(".sg-headbox-right").show(),s(".sg-dynamic-hide").hide(),s(".sg-data-add",o).click(function(e){h(s(this).attr("href")),e.preventDefault()}),s(".sg-control-form",o).ajaxForm({beforeSubmit:function(e,t,a){t=t.attr("data-target-id");void 0!==t&&null!=t&&0!=t.length||(t="#sg-control",p());t=s(t);return t.wrapInner("<div class='sg-disabled'></div>"),t.prepend(s("#sg-wait").html()),!0},success:function(e,t,a,n){n=n.attr("data-target-id");void 0!==n&&null!=n&&0!=n.length||(n="#sg-control");n=s(n);n.html(e),g(n)},error:function(e,t,a,n){n=n.attr("data-target-id");void 0!==n&&null!=n&&0!=n.length||(n="#sg-control"),s(n).html(e.statusText),alert("Error "+e.status+"\n"+e.statusText)}}),s(".sg-submit-form",o).change(function(){s(this).closest("form").submit()}),s(".sg-control-set",o).click(function(e){var t=s(this),a=t.attr("data-target-id");void 0!==a&&null!=a&&0!=a.length||(a="#sg-control",p());var n=s(a);n.wrapInner("<div class='sg-disabled'></div>"),n.prepend(s("#sg-wait").html()),s.get(t.attr("href"),function(e){n.html(e),g(n)}).fail(function(){alert("ERROR")}),e.preventDefault()}),s("[data-data-dblclick]",o).dblclick(function(){s.get(s(this).attr("data-data-dblclick"),function(e){var t=e.match(u);null!=t&&2<=t.length&&s("#"+t[2]).remove();t=s("#sg-data");t.prepend(e);t=t.children(":first");g(t),s("html, body").animate({scrollTop:t.offset().top},500)}).fail(function(){alert("ERROR")})}),s("tr [data-confirm]",o).click(function(e){var t,a=s(this);confirm(a.attr("data-confirm"))&&((t=a.closest("tr")).addClass("sg-disabled"),s.get(a.attr("href"),function(e){t.slideUp("fast",function(){t.remove()})}).fail(function(){alert("ERROR")})),e.preventDefault()}),s(".sg-control-confirm",o).click(function(e){var t,a=s(this);confirm(a.attr("data-confirm"))&&((t=s("#"+a.attr("data-target"))).addClass("sg-disabled"),s.get(a.attr("href"),function(e){t.fadeOut("slow",function(){t.remove()})}).fail(function(){alert("ERROR")})),e.preventDefault()}),s(".sg-replace-content",o).on("shown.bs.tab",function(e){var t=s(s(this).attr("href")),a=s(this).attr("data-url");s.get(a,function(e){t.html(e),g(t)}).fail(function(){alert("ERROR")}),s(this).removeClass("sg-replace-content"),s(this).unbind("shown.bs.tab")}),s(".sg-data-close",o).click(function(e){s(this).parent().parent().fadeOut("fast",function(){s(this).remove()})}),s("input.sg-fileupload",o).fileinput({showUpload:!1}),s("input.sg-fileupload-small",o).fileinput({showUpload:!1,previewSettings:{image:{width:"auto",height:"24px"}}}),s(".sg-pictogram-modal",o).on("shown.bs.modal",function(){var n=s(this),r=n.attr("id"),i=s("#container-"+r,n),e=s("#filter-"+r,n);e.on("input propertychange paste",function(){a(n,i,r,o,s(this).val())}).onEnter(function(){var e,t,a=s(".sg-pictogram-modal-link",i).first();0<a.length&&(e=a.attr("data-id"),t=a.attr("data-id"),a=s("<div/>").text(a.attr("title")).html(),s("#value-"+r,o).val(e),s("#preview-"+r,o).html('<img src="'+urlSegradaPictogramFile+t+'" width="24" height="24" alt="'+a+'" /> '+a),s("#clear-"+r,o).show(),n.modal("hide"))}),""===e.val()&&a(n,i,r,o,"")}),s(".sg-pictogram-chooser",o).click(function(e){s("#"+s(this).attr("data-id")).modal("show"),e.preventDefault()}),s(".sg-pictogram-clearer",o).click(function(e){var t=s(this).attr("data-id");s("#value-"+t,o).val(""),s("#preview-"+t,o).html(""),s(this).hide(),e.preventDefault()}),s(".sg-source-ref-modal",o).on("shown.bs.modal",function(){var i=s(this),t=s(".modal-body",i);s.get(i.attr("data-href"),function(e){t.html(e),s("select.sg-colorpicker",i).simplepicker({theme:"fontawesome"}),s("form",t).ajaxForm({beforeSubmit:function(e,t,a){return t.wrapInner("<div class='sg-disabled'></div>"),t.prepend(s("#sg-wait").html()),!0},success:function(e,t,a,n){var r=s(i.attr("data-target"));r.html(e),g(r),i.modal("hide"),s(".modal-backdrop").remove(),s("body").removeClass("modal-open")},error:function(e,t,a,n){alert("Error "+e.status+"\n"+e.statusText)}})}).fail(function(){alert("ERROR")})}).on("hidden.bs.modal",function(){s(".modal-body",s(this)).html(s("#sg-wait").html())}),s(".sg-source-ref-editor",o).click(function(e){var t=s("#"+s(this).attr("data-id"));t.attr("data-href",s(this).attr("href")),t.modal("show"),e.preventDefault()}),s(".sg-taglist-contract",o).each(function(){var e=s("span",s(this));1<e.length&&(e.hide().filter(":first-child").show().after('<span class="sg-tag-show label label-default"><i class="fa fa-plus"></i></span>'),s("span.sg-tag-show",s(this)).click(function(){s(this).remove(),e.show()}))}),s("select.sg-colorpicker",o).simplepicker({theme:"fontawesome"}),s("select.sg-tags",o).each(function(){var t=s(this);t.tagsinput({trimValue:!0,confirmKeys:[13],typeaheadjs:{name:"tags",limit:25,displayKey:"title",valueKey:"title",source:n(urlSegradaTagSearch),async:!0}}),t.on("itemRemoved",function(e){t.find('option[value="'+e.item+'"]').remove()})}),s("input.sg-node-search",o).each(function(){var e=s(this),a=s("#"+e.attr("data-id"));e.typeahead({hint:!0,highlight:!0,minLength:1},{async:!0,name:"node",limit:25,displayKey:"title",valueKey:"id",source:t()}).bind("typeahead:selected",function(e,t){a.val(t.id)}).bind("keyup",function(){this.value||a.val("")})}),s("input.sg-file-search",o).each(function(){var e=s(this),a=s("#"+e.attr("data-id"));e.typeahead({hint:!0,highlight:!0,minLength:1},{async:!0,name:"file",limit:25,displayKey:"title",valueKey:"id",source:n(urlSegradaFileSearch)}).bind("typeahead:selected",function(e,t){a.val(t.id)}).bind("keyup",function(){this.value||a.val("")})}),s("input.sg-source-search",o).each(function(){var e=s(this),a=s("#"+e.attr("data-id"));e.typeahead({hint:!0,highlight:!0,minLength:1},{async:!0,name:"source",limit:25,displayKey:"title",valueKey:"id",source:n(urlSegradaSourceSearch)}).bind("typeahead:selected",function(e,t){a.val(t.id)}).bind("keyup",function(){this.value||a.val("")})}),s(".sg-link-external",o).click(function(e){var t=s(this).attr("href");window.open(t,"_blank").focus(),e.preventDefault()}),s("form.sg-data-form",o).ajaxForm({beforeSubmit:function(e,t,a){return s(":input",t).attr("disabled",!0),s("button.btn-primary",t).append(" "+s("#sg-wait-btn").html()),!0},success:function(e,t,a,n){var r=n.attr("data-id");(r=(r=void 0!==r?s("#"+r):r)||n).replaceWith(e);e=e.match(u);null!=e&&2<=e.length&&g(s("#"+e[2]))},error:function(e,t,a,n){s(":input",n).attr("disabled",!1),alert("Error "+e.status+"\n"+e.statusText)}}),s("form.sg-simple-form",o).ajaxForm({beforeSubmit:function(e,t,a){s(":input",t).attr("disabled",!0);var n=t.attr("data-id");return(n=(n=void 0!==n?s("#"+n):n)||t).html(s("#sg-wait")),!0},success:function(e,t,a,n){var r=n.attr("data-id");(r=(r=void 0!==r?s("#"+r):r)||n).html(e),s(":input",n).attr("disabled",!1)},error:function(e,t,a,n){s(":input",n).attr("disabled",!1),alert("Error "+e.status+"\n"+e.statusText)}}),s(".sg-periods").each(function(){var r=s(this),i=r.attr("id"),e=s(".sg-period-form",r);s(".sg-period-add",r).click(function(e){s(this).hide();var t=s(".sg-period-form-add",r);t.show(),s(".sg-period-form-period",t).change(function(e){s(this).is(":checked")?s(".sg-period-toggle",t).show():s(".sg-period-toggle",t).hide()}),e.preventDefault()}),e.ajaxForm({beforeSubmit:function(e,t,a){return r.addClass("disabled"),!0},success:function(e,t,a,n){r.replaceWith(e),g(s("#"+i))},error:function(e,t,a,n){r.removeClass("disabled"),alert("Error "+e.status+"\n"+e.statusText)}})}),s(".sg-ajax-modal",o).click(function(e){var t=s("#sg-modal"),a=s(".modal-body-inner",t),n=s(".modal-loading",t);s("h4",t).html(s(this).attr("data-title")),a.html(""),a.hide(),n.show(),t.modal("show"),s.get(s(this).attr("href"),function(e){n.hide(),a.html(e),a.show(),g(a)}).fail(function(){alert("ERROR")}),e.preventDefault()}),s(".sg-ajax-modal-form",o).ajaxForm({beforeSubmit:function(e,t,a){var n=s("#sg-modal"),r=s(".modal-body-inner",n),n=s(".modal-loading",n);return r.hide(),n.show(),!0},success:function(e,t,a,n){var r=s("#sg-modal"),i=s(".modal-body-inner",r),o=s(".modal-loading",r);i.html(e),i.show(),o.hide(),g(i),r=s("#sg-modal"),s(".sg-update-period",r).each(function(){var e=s(this).attr("data-id"),t=s(e);if(0<t.length)for(var a=0;a<3;a++)s("td:eq("+a+")",t).html(s("div:eq("+a+")",s(this)).html())})},error:function(e,t,a,n){var r=s("#sg-modal"),i=s(".modal-body-inner",r),r=s(".modal-loading",r);i.html(e),i.show(),r.hide(),g(i)}}),s(".sg-plain-editor",o).click(function(e){s(s(this).attr("data-editor")).summernote("destroy")}),s(".sg-html-editor",o).each(function(){var e=s("html").attr("lang"),t={lang:e="en"===e?"en-US":e},e=s(this),a=s(e.attr("data-editor"));e.attr("checked")&&a.summernote(t),e.click(function(e){a.summernote(t)})}),s(".sg-lg-image",o).each(function(){var e=s(this).attr("id");e&&new Viewer(document.getElementById(e),{navbar:!1,toolbar:{zoomIn:1,zoomOut:1,oneToOne:1,reset:1,prev:0,play:{show:1,size:"large"},next:0,rotateLeft:1,rotateRight:1,flipHorizontal:1,flipVertical:1}})}),s("a.sg-graph-update",o).click(function(e){v(s(this).attr("href")),e.preventDefault()}),s("a.sg-graph-replace",o).click(function(e){b(),v(s(this).attr("href"));var t=s(this).attr("data-title");0!=t.length&&(i=t);t=s(this).attr("data-uid");0!=t.length&&(c=t),e.preventDefault()}),s("div.sg-tag-hierarchy",o).each(function(){var e=s(this),t=s(".sg-tag-hierarchy-graph",e);s(".sg-child-tags",e).hide(),t.addClass("sg-margin-top sg-margin-bottom");var e=s(".sg-tag-hierarchy-data",e),n=e.attr("data-center"),r=0,i=0,o=[],l=[];s("div",e).each(function(){var e=s(this),t=e.attr("data-id"),a=e.attr("data-level");o.push({id:t,label:e.html(),level:a,url:e.attr("data-url")}),"0"==a?(l.push({from:t,to:n}),r++):"2"==a&&(l.push({from:n,to:t}),i++)});e=i<r?0==r?1:r:i;t.css({width:"100%",height:50*e+"px",border:"1px solid #ccc"});var a={nodes:new vis.DataSet(o),edges:new vis.DataSet(l)},o=null,l=null;new vis.Network(t.get(0),a,{edges:{smooth:{type:"cubicBezier",forceDirection:"horizontal",roundness:.6}},nodes:{shape:"box"},layout:{hierarchical:{direction:"LR"}}}).on("doubleClick",function(e){var t=null;0<e.nodes.length&&(null!=(e=a.nodes.get(e.nodes[0]))&&null!=e.url&&(t=e.url)),null!=t&&h(t)})});for(var e=0;e<afterAjaxHooks.length;e++)afterAjaxHooks[e](o)}function f(){var e,t,a;r||(r=!0,e=document.getElementById("sg-graph"),t={nodes:o,edges:l},a={locale:s("html").attr("lang"),locales:{de:{edit:"Änderungsmodus",del:"Lösche Auswahl",back:"Zurück",addNode:"Knoten hinzufügen",addEdge:"Verknüpfung hinzufügen",editNode:"Knoten editieren",editEdge:"Verknüpfung editieren",addDescription:"Klicke auf eine freie Stelle, um einen neuen Knoten zu plazieren.",edgeDescription:"Klicke auf einen Knoten und ziehe die Verknüpfung zu einem anderen Knoten, um diese zu verbinden.",editEdgeDescription:"Klicke auf die Verbindungspunkte und ziehe diese auf einen Knoten, um sie zu verbinden.",createEdgeError:"Es ist nicht möglich, Verknüpfungen mit Clustern zu verbinden.",deleteClusterError:"Cluster können nicht gelöscht werden.",editClusterError:"Cluster können nicht editiert werden."},en:{edit:"Toggle edit",del:"Delete selected",back:"Back",addNode:"Add Node",addEdge:"Add Relation",editNode:"Edit Node",editEdge:"Edit Relation",addDescription:"Click in an empty space to place a new node.",edgeDescription:"Click on a node and drag the relation to another node to connect them.",editEdgeDescription:"Click on the control points and drag them to a node to connect to it.",createEdgeError:"Cannot link relations to a cluster.",deleteClusterError:"Clusters cannot be deleted.",editClusterError:"Clusters cannot be edited."}},manipulation:{enabled:!0,addNode:!1,addEdge:function(e,t){return h(urlSegradaRelationAdd.replace("XFROMX",e.from.replace(/#([0-9]+):([0-9]+)/,"$1-$2")).replace("XTOX",e.to.replace(/#([0-9]+):([0-9]+)/,"$1-$2")).replace("&amp;","&")),!1},editNode:function(e,t){return!1},editEdge:function(e,t){return!1},deleteNode:function(e,t){return!1},deleteEdge:function(e,t){return!1}},nodes:{shape:"icon",color:{border:"#000",background:"#fff"}},edges:{font:{size:10},labelHighlightBold:!1,selectionWidth:0,arrows:{to:!0},smooth:{type:"cubicBezier"}},groups:{node:{icon:{code:"",color:"#000000"}},tag:{shape:"box",color:{border:"#5bc0de",background:"#5bc0de",highlight:{background:"#2B7CE9"}},font:{color:"#ffffff",size:12}}},physics:{barnesHut:{springLength:120}}},(d=new vis.Network(e,t,a)).on("doubleClick",function(e){var t,a=null;0<e.nodes.length?null!=(t=o.get(e.nodes[0]))&&null!=t.url&&(a=t.url):0<e.edges.length&&(null!=(e=l.get(e.edges[0]))&&null!=e.url&&(a=e.url)),null!=a&&h(a)}))}function p(){var e=s("#sg-toggle-graph");e.hasClass("active")&&(e.removeClass("active"),s(".fa-share-alt-square",e).addClass("fa-share-alt").removeClass("fa-share-alt-square"),d.storePositions(),s("#sg-graph-container").hide(),s("#sg-control").show(),d.destroy(),r=!1)}function m(){var e=s("#sg-toggle-graph");e.hasClass("active")||(e.addClass("active"),s(".fa-share-alt",e).addClass("fa-share-alt-square").removeClass("fa-share-alt"),s("#sg-control").hide(),s("#sg-graph-container").show(),f())}function v(e){if(null!=e){m(),(i=s("#sg-graph")).css("background",'url("'+i.attr("data-bg")+'") no-repeat center center');for(var t=[],a=[],n=o.get({fields:["id"]}),r=0;r<n.length;r++)t.push(n[r].id);for(n=l.get({fields:["id"]}),r=0;r<n.length;r++)a.push(n[r].id);var i=s("#sg-graph-container").attr("data-csrf");s.ajax({url:e,type:"POST",dataType:"json",headers:{"Content-Type":"application/json","X-CSRF-Token":i},data:JSON.stringify({nodes:t,edges:a}),success:function(e,t,a){s("#sg-graph").css("background","transparent"),null!=e?null==e.error?(null!=e.nodes&&0<e.nodes.length&&o.update(e.nodes),null!=e.edges&&0<e.edges.length&&l.update(e.edges),null!=e.removeNodes&&0<e.removeNodes.length&&o.remove(e.removeNodes),null!=e.removeEdges&&0<e.removeEdges.length&&l.remove(e.removeEdges),null!=e.highlightNode&&(d.unselectAll(),d.selectNodes([e.highlightNode],!1)),d.fit()):alert(e.error):alert("NULL data")}})}else alert("Null url!")}function b(){l.clear(),o.clear(),i=c=""}s.event.special.destroyed={remove:function(e){e.handler&&e.handler()}},s(document).ready(function(){s("#sg-close-all").click(function(e){s(".sg-data").fadeOut("fast",function(){s(this).remove()}),e.preventDefault()}),s(".sg-locale").click(function(e){s.get(s(this).attr("href"),function(e){var t=s("#sg-base").html();""!=e&&(window.location.href=t)}).fail(function(){alert("ERROR")}),e.preventDefault()}),s("#sg-toggle-graph").click(function(e){(s(this).hasClass("active")?p:m)(),e.preventDefault()}),s("#sg-graph-action-remove").click(function(e){var t=d.getSelection();0<t.edges.length&&l.remove(t.edges),0<t.nodes.length&&o.remove(t.nodes),e.preventDefault()}),s("#sg-graph-action-restart").click(function(e){b(),e.preventDefault()}),s("#sg-graph-action-reload").click(function(e){d.destroy(),r=!1,f(),e.preventDefault()}),s("#sg-graph-action-fit").click(function(e){d.fit(),e.preventDefault()}),s("#sg-graph-close").click(function(e){p(),e.preventDefault()}),s("#sg-graph-action-load").click(function(e){s("#sg-graph-modal-load").modal(),e.preventDefault()}),s("#sg-graph-action-save").click(function(e){var t;0<o.length&&(s("#title-sg-graph-save").val(null!==i?i:""),t=s("#save-as-new-sg-graph-save").parent().parent().parent(),null!==c?t.show():t.hide(),s("#sg-graph-modal-save").modal()),e.preventDefault()}),s("#sg-graph-modal-load").on("shown.bs.modal",function(){var n=s(this),r=s(".modal-body",n);r.html(s("#sg-wait").html());var e=n.attr("data-url");s.get(e,function(e){var t=n.attr("data-get-url"),a="";e.forEach(function(e){a+="<li><a href='"+t+e.uid+"' data-uid='"+e.uid+"'>"+e.title+"</a></li>"}),""!=a&&(a="<ul>"+a+"</ul>"),r.html(a),s("a",r).click(function(e){b(),v(s(this).attr("href")),i=s(this).html(),c=s(this).attr("data-uid"),n.modal("hide"),e.preventDefault()})})}),s("#sg-graph-modal-save-frm").submit(function(e){e.preventDefault();var t=s("#title-sg-graph-save").val(),e=c;null!=c&&s("#save-as-new-sg-graph-save").is(":checked")&&(e=null),d.storePositions();var a=[],n=[];o.forEach(function(e){a.push({id:e.id,x:e.x,y:e.y,group:e.group})}),l.forEach(function(e){n.push({id:e.id,group:e.group})});s.post(s(this).attr("action"),{_csrf:s("#sg-graph-container").attr("data-csrf"),uid:e,title:t,type:"graph",data:JSON.stringify({nodes:a,edges:n})},function(e){i=t,c=e}).fail(function(){alert("ERROR")}),s("#sg-graph-modal-save").modal("hide")}),g(s("body"))})}(jQuery);
