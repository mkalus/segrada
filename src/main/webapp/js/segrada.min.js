function escapeHTML(t){return"string"==typeof t?t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"):""}!function(c){function a(a){return function(t,e){c.ajax({url:a+encodeURIComponent(t)}).done(function(t){e(t)})}}function n(){return function(t,e){let a=urlSegradaNodeSearch+encodeURIComponent(t);const n=c(".sg-node-search").filter(":focus"),o=c("#"+n.attr("data-select-id")+" option").filter(":selected");t=o.attr(n.attr("data-attr"));null!=t&&0<t.length&&(a+="&tags="+encodeURIComponent(t)),c.ajax({url:a}).done(function(t){e(t)})}}function o(a){return new Promise((e,t)=>{r(a,function(t){e(t.map(t=>t.title))})})}function i(t,e,a){return t.typeahead({source:a,items:"all",matcher:()=>!0,displayText:t=>t.title,autoSelect:!1,delay:200,afterSelect:function(t){e.val(t.id)}}).change(function(){""===t.val()&&e.val(null)})}const r=a(urlSegradaTagSearch);function t(t){return t.replace(/;jsessionid=([^?]*)/,"")}urlSegradaPictogramSearch=t(urlSegradaPictogramSearch),urlSegradaPictogramFile=t(urlSegradaPictogramFile),urlSegradaTagSearch=t(urlSegradaTagSearch),urlSegradaNodeSearch=t(urlSegradaNodeSearch),urlSegradaFileSearch=t(urlSegradaFileSearch),urlSegradaSourceSearch=t(urlSegradaSourceSearch),urlSegradaRelationAdd=t(urlSegradaRelationAdd);let s=!1;const l=new vis.DataSet([]),d=new vis.DataSet([]);let u=null,h=null,g=null;c.fn.onEnter=function(e){return this.bind("keypress",function(t){(void 0!==t.key&&"Enter"===t.key||13===t.keyCode)&&e.apply(this,[t])}),this};const f=new RegExp(/<([^\s]+).*?id="([^"]*?)".*?>/i);function e(o,e,i,r,t){t=urlSegradaPictogramSearch+encodeURIComponent(t);c.getJSON(t,function(t){const n=[];c.each(t,function(t,e){var a=c("<div/>").text(e.title).html();n.push('<div class="col-xs-1 sg-no-padding-right"><a class="sg-pictogram-modal-link" href="#" data-id="'+e.id+'" data-uid="'+e.uid+'" title="'+a+'"><img src="'+urlSegradaPictogramFile+e.uid+'" width="24" height="24" alt="'+a+'" /></a></div>')}),e.html("<div class='row'>"+n.join("")+"</div>"),c("a",e).click(function(t){var e=c(this).attr("data-id"),a=c(this).attr("data-uid"),n=c("<div/>").text(c(this).attr("title")).html();c("#value-"+i,r).val(e),c("#preview-"+i,r).html('<img src="'+urlSegradaPictogramFile+a+'" width="24" height="24" alt="'+n+'" /> '+n),c("#clear-"+i,r).show(),t.preventDefault(),o.modal("hide")})}).fail(function(){alert("ERROR")})}function p(t){c.get(t,function(t){var e=t.match(f);null!=e&&2<=e.length&&c("#"+e[2]).remove();const a=c("#sg-data");a.prepend(t);const n=a.children(":first");m(n),c("html, body").animate({scrollTop:n.offset().top},500)}).fail(function(){alert("ERROR")})}function m(s){s=s||c("body"),c(".sg-data").addClass("sg-dynamic-data"),c(".sg-headbox-right").show(),c(".sg-dynamic-hide").hide(),c(".sg-data-add",s).click(function(t){p(c(this).attr("href")),t.preventDefault()}),c(".sg-control-form",s).ajaxForm({beforeSubmit:function(t,e,a){let n=e.attr("data-target-id");void 0!==n&&null!==n&&0!==n.length||(n="#sg-control",k());const o=c(n);return o.wrapInner("<div class='sg-disabled'></div>"),o.prepend(c("#sg-wait").html()),!0},success:function(t,e,a,n){let o=n.attr("data-target-id");void 0!==o&&null!=o&&0!==o.length||(o="#sg-control");const i=c(o);i.html(t),m(i)},error:function(t,e,a,n){let o=n.attr("data-target-id");void 0!==o&&null!=o&&0!==o.length||(o="#sg-control");const i=c(o);i.html(t.statusText),alert("Error "+t.status+"\n"+t.statusText)}}),c(".sg-submit-form",s).change(function(){c(this).closest("form").submit()}),c(".sg-control-set",s).click(function(t){const e=c(this);let a=e.attr("data-target-id");void 0!==a&&null!=a&&0!=a.length||(a="#sg-control",k());const n=c(a);n.wrapInner("<div class='sg-disabled'></div>"),n.prepend(c("#sg-wait").html()),c.get(e.attr("href"),function(t){n.html(t),m(n)}).fail(function(){alert("ERROR")}),t.preventDefault()}),c("[data-data-dblclick]",s).dblclick(function(){c.get(c(this).attr("data-data-dblclick"),function(t){var e=t.match(f);null!=e&&2<=e.length&&c("#"+e[2]).remove();const a=c("#sg-data");a.prepend(t);const n=a.children(":first");m(n),c("html, body").animate({scrollTop:n.offset().top},500)}).fail(function(){alert("ERROR")})}),c("tr [data-confirm]",s).click(function(t){const e=c(this);if(confirm(e.attr("data-confirm"))){const a=e.closest("tr");a.addClass("sg-disabled"),c.get(e.attr("href"),function(t){a.slideUp("fast",function(){a.remove()})}).fail(function(){alert("ERROR")})}t.preventDefault()}),c(".sg-control-confirm",s).click(function(t){const e=c(this);if(confirm(e.attr("data-confirm"))){const a=c("#"+e.attr("data-target"));a.addClass("sg-disabled"),c.get(e.attr("href"),function(t){a.fadeOut("slow",function(){a.remove()})}).fail(function(){alert("ERROR")})}t.preventDefault()}),c(".sg-replace-content",s).on("shown.bs.tab",function(t){const e=c(c(this).attr("href"));var a=c(this).attr("data-url");c.get(a,function(t){e.html(t),m(e)}).fail(function(){alert("ERROR")}),c(this).removeClass("sg-replace-content"),c(this).unbind("shown.bs.tab")}),c(".sg-data-close",s).click(function(t){c(this).parent().parent().fadeOut("fast",function(){c(this).remove()})}),c("input.sg-fileupload",s).fileinput({showUpload:!1}),c("input.sg-fileupload-small",s).fileinput({showUpload:!1,previewSettings:{image:{width:"auto",height:"24px"}}}),c(".sg-pictogram-modal",s).on("shown.bs.modal",function(){const o=c(this),i=o.attr("id"),r=c("#container-"+i,o),t=c("#filter-"+i,o);t.on("input propertychange paste",function(){e(o,r,i,s,c(this).val())}).onEnter(function(){const t=c(".sg-pictogram-modal-link",r).first();var e,a,n;0<t.length&&(e=t.attr("data-id"),a=t.attr("data-id"),n=c("<div/>").text(t.attr("title")).html(),c("#value-"+i,s).val(e),c("#preview-"+i,s).html('<img src="'+urlSegradaPictogramFile+a+'" width="24" height="24" alt="'+n+'" /> '+n),c("#clear-"+i,s).show(),o.modal("hide"))}),""===t.val()&&e(o,r,i,s,"")}),c(".sg-pictogram-chooser",s).click(function(t){c("#"+c(this).attr("data-id")).modal("show"),t.preventDefault()}),c(".sg-pictogram-clearer",s).click(function(t){var e=c(this).attr("data-id");c("#value-"+e,s).val(""),c("#preview-"+e,s).html(""),c(this).hide(),t.preventDefault()}),c(".sg-source-ref-modal",s).on("shown.bs.modal",function(){const i=c(this),e=c(".modal-body",i);c.get(i.attr("data-href"),function(t){e.html(t),c("select.sg-colorpicker",i).simplepicker({theme:"fontawesome"}),c("form",e).ajaxForm({beforeSubmit:function(t,e,a){return e.wrapInner("<div class='sg-disabled'></div>"),e.prepend(c("#sg-wait").html()),!0},success:function(t,e,a,n){const o=c(i.attr("data-target"));o.html(t),m(o),i.modal("hide"),c(".modal-backdrop").remove(),c("body").removeClass("modal-open")},error:function(t,e,a,n){alert("Error "+t.status+"\n"+t.statusText)}})}).fail(function(){alert("ERROR")})}).on("hidden.bs.modal",function(){c(".modal-body",c(this)).html(c("#sg-wait").html())}),c(".sg-source-ref-editor",s).click(function(t){const e=c("#"+c(this).attr("data-id"));e.attr("data-href",c(this).attr("href")),e.modal("show"),t.preventDefault()}),c(".sg-taglist-contract",s).each(function(){const t=c("span",c(this));1<t.length&&(t.hide().filter(":first-child").show().after('<span class="sg-tag-show label label-default"><i class="fa fa-plus"></i></span>'),c("span.sg-tag-show",c(this)).click(function(){c(this).remove(),t.show()}))}),c("select.sg-colorpicker",s).simplepicker({theme:"fontawesome"}),c("select.sg-tags",s).each(function(){const e=c(this),t=document.createElement("input");t.setAttribute("type","text"),t.setAttribute("class","form-control"),e.after(t),e.hide();const a=tagger(t,{wrap:!0,completion:{list:o,min_length:1,delay:200}}),n=e.val();n&&n.length&&n.map(t=>a.add_tag(t)),t.addEventListener("add_tag",function(t){e.append(c("<option>",{text:t.item,value:t.item,selected:!0}))}),t.addEventListener("remove_tag",function(t){c("option",e).each(function(){c(this).val()===t.item&&c(this).remove()})})}),c("input.sg-node-search",s).each(function(){const t=c(this);var e=c("#"+t.attr("data-id"));i(t,e,n())}),c("input.sg-file-search",s).each(function(){const t=c(this);var e=c("#"+t.attr("data-id"));i(t,e,a(urlSegradaFileSearch))}),c("input.sg-source-search",s).each(function(){const t=c(this);var e=c("#"+t.attr("data-id"));i(t,e,a(urlSegradaSourceSearch))}),c(".sg-link-external",s).click(function(t){var e=c(this).attr("href");const a=window.open(e,"_blank");a.focus(),t.preventDefault()}),c("form.sg-data-form",s).ajaxForm({beforeSubmit:function(t,e,a){return c(":input",e).attr("disabled",!0),c("button.btn-primary",e).append(" "+c("#sg-wait-btn").html()),!0},success:function(t,e,a,n){let o=n.attr("data-id");void 0!==o&&(o=c("#"+o)),o=o||n,o.replaceWith(t);t=t.match(f);null!=t&&2<=t.length&&m(c("#"+t[2]))},error:function(t,e,a,n){c(":input",n).attr("disabled",!1),alert("Error "+t.status+"\n"+t.statusText)}}),c("form.sg-simple-form",s).ajaxForm({beforeSubmit:function(t,e,a){c(":input",e).attr("disabled",!0);let n=e.attr("data-id");return void 0!==n&&(n=c("#"+n)),n=n||e,n.html(c("#sg-wait")),!0},success:function(t,e,a,n){let o=n.attr("data-id");void 0!==o&&(o=c("#"+o)),o=o||n,o.html(t),c(":input",n).attr("disabled",!1)},error:function(t,e,a,n){c(":input",n).attr("disabled",!1),alert("Error "+t.status+"\n"+t.statusText)}}),c(".sg-periods").each(function(){const o=c(this),i=o.attr("id"),t=c(".sg-period-form",o);c(".sg-period-add",o).click(function(t){c(this).hide();const e=c(".sg-period-form-add",o);e.show(),c(".sg-period-form-period",e).change(function(t){c(this).is(":checked")?c(".sg-period-toggle",e).show():c(".sg-period-toggle",e).hide()}),t.preventDefault()}),t.ajaxForm({beforeSubmit:function(t,e,a){return o.addClass("disabled"),!0},success:function(t,e,a,n){o.replaceWith(t),m(c("#"+i))},error:function(t,e,a,n){o.removeClass("disabled"),alert("Error "+t.status+"\n"+t.statusText)}})}),c(".sg-ajax-modal",s).click(function(t){const e=c("#sg-modal"),a=c(".modal-body-inner",e),n=c(".modal-loading",e);c("h4",e).html(c(this).attr("data-title")),a.html(""),a.hide(),n.show(),e.modal("show"),c.get(c(this).attr("href"),function(t){n.hide(),a.html(t),a.show(),m(a)}).fail(function(){alert("ERROR")}),t.preventDefault()}),c(".sg-ajax-modal-form",s).ajaxForm({beforeSubmit:function(t,e,a){var n=c("#sg-modal");const o=c(".modal-body-inner",n),i=c(".modal-loading",n);return o.hide(),i.show(),!0},success:function(t,e,a,n){var o=c("#sg-modal");const i=c(".modal-body-inner",o),r=c(".modal-loading",o);i.html(t),i.show(),r.hide(),m(i),o=c("#sg-modal"),c(".sg-update-period",o).each(function(){var t=c(this).attr("data-id"),e=c(t);if(0<e.length)for(let t=0;t<3;t++)c("td:eq("+t+")",e).html(c("div:eq("+t+")",c(this)).html())})},error:function(t,e,a,n){var o=c("#sg-modal");const i=c(".modal-body-inner",o),r=c(".modal-loading",o);i.html(t),i.show(),r.hide(),m(i)}}),c(".sg-plain-editor",s).click(function(t){c(c(this).attr("data-editor")).summernote("destroy")}),c(".sg-html-editor",s).each(function(){let t=c("html").attr("lang");"en"===t&&(t="en-US");const e={lang:t},a=c(this),n=c(a.attr("data-editor"));a.attr("checked")&&n.summernote(e),a.click(function(t){n.summernote(e)})}),c(".sg-lg-image",s).each(function(){var t=c(this).attr("id");t&&new Viewer(document.getElementById(t),{navbar:!1,toolbar:{zoomIn:1,zoomOut:1,oneToOne:1,reset:1,prev:0,play:{show:1,size:"large"},next:0,rotateLeft:1,rotateRight:1,flipHorizontal:1,flipVertical:1}})}),c(".sg-query-builder",s).each(function(){const e=c("#"+c(this).attr("data-id"));var t=c(this).attr("data");let a;try{a=JSON.parse(t),Array.isArray(a)||(a=void 0)}catch(t){a=void 0}let n=void 0;t=c("#sg-map-settings").html();t&&(n=JSON.parse(t)),createSegradaQueryBuilder("#"+c(this).attr("id"),c("html").attr("lang"),window.location.protocol+"//"+window.location.host+"/",a,n,function(t){e.val(JSON.stringify(t))})}),c("a.sg-graph-update",s).click(function(t){y(c(this).attr("href")),t.preventDefault()}),c("a.sg-graph-replace",s).click(function(t){x(),y(c(this).attr("href"));var e=c(this).attr("data-title");0!==e.length&&(h=e);e=c(this).attr("data-uid");0!==e.length&&(g=e),t.preventDefault()}),c("div.sg-tag-hierarchy",s).each(function(){var t=c(this);const e=c(".sg-tag-hierarchy-graph",t);c(".sg-child-tags",t).hide(),e.addClass("sg-margin-top sg-margin-bottom");const a=c(".sg-tag-hierarchy-data",t),n=a.attr("data-center");let o=0,i=0,r=[],s=[];c("div",a).each(function(){const t=c(this);var e=t.attr("data-id"),a=t.attr("data-level");r.push({id:e,label:t.html(),level:a,url:t.attr("data-url")}),"0"===a?(s.push({from:e,to:n}),o++):"2"===a&&(s.push({from:n,to:e}),i++)});t=o>i?0===o?1:o:i;e.css({width:"100%",height:50*t+"px",border:"1px solid #ccc"});const l={nodes:new vis.DataSet(r),edges:new vis.DataSet(s)};r=null,s=null;const d=new vis.Network(e.get(0),l,{edges:{smooth:{type:"cubicBezier",forceDirection:"horizontal",roundness:.6}},nodes:{shape:"box"},layout:{hierarchical:{direction:"LR"}}});d.on("doubleClick",function(t){let e=null;0<t.nodes.length&&(null!=(t=l.nodes.get(t.nodes[0]))&&null!=t.url&&(e=t.url)),null!=e&&p(e)})});for(let t=0;t<afterAjaxHooks.length;t++)afterAjaxHooks[t](s)}let v=!0;function b(){if(!s){s=!0;var t=document.getElementById("sg-graph"),e={nodes:l,edges:d},a={locale:c("html").attr("lang"),locales:{de:{edit:"Änderungsmodus",del:"Lösche Auswahl",back:"Zurück",addNode:"Knoten hinzufügen",addEdge:"Verknüpfung hinzufügen",editNode:"Knoten editieren",editEdge:"Verknüpfung editieren",addDescription:"Klicke auf eine freie Stelle, um einen neuen Knoten zu platzieren.",edgeDescription:"Klicke auf einen Knoten und ziehe die Verknüpfung zu einem anderen Knoten, um diese zu verbinden.",editEdgeDescription:"Klicke auf die Verbindungspunkte und ziehe diese auf einen Knoten, um sie zu verbinden.",createEdgeError:"Es ist nicht möglich, Verknüpfungen mit Clustern zu verbinden.",deleteClusterError:"Cluster können nicht gelöscht werden.",editClusterError:"Cluster können nicht editiert werden."},en:{edit:"Toggle edit",del:"Delete selected",back:"Back",addNode:"Add Node",addEdge:"Add Relation",editNode:"Edit Node",editEdge:"Edit Relation",addDescription:"Click in an empty space to place a new node.",edgeDescription:"Click on a node and drag the relation to another node to connect them.",editEdgeDescription:"Click on the control points and drag them to a node to connect to it.",createEdgeError:"Cannot link relations to a cluster.",deleteClusterError:"Clusters cannot be deleted.",editClusterError:"Clusters cannot be edited."}},manipulation:{enabled:!0,addNode:!1,addEdge:function(t,e){return p(urlSegradaRelationAdd.replace("XFROMX",t.from.replace(/#([0-9]+):([0-9]+)/,"$1-$2")).replace("XTOX",t.to.replace(/#([0-9]+):([0-9]+)/,"$1-$2")).replace("&amp;","&")),!1},editNode:function(t,e){return!1},editEdge:function(t,e){return!1},deleteNode:function(t,e){return!1},deleteEdge:function(t,e){return!1}},nodes:{shape:"icon",widthConstraint:{maximum:120}},edges:{font:{size:10},labelHighlightBold:!1,arrows:{to:{enabled:!0}}},groups:{node:{},tag:{shape:"box",color:{border:"#5bc0de",background:"#5bc0de",highlight:{background:"#2B7CE9"}},font:{color:"#ffffff",size:12}}},physics:{barnesHut:{springLength:150,damping:.4,avoidOverlap:.5}},layout:{improvedLayout:!0}};u=new vis.Network(t,e,a),u.on("doubleClick",function(t){let e=null;var a;0<t.nodes.length?null!=(a=l.get(t.nodes[0]))&&null!=a.url&&(e=a.url):0<t.edges.length&&(null!=(t=d.get(t.edges[0]))&&null!=t.url&&(e=t.url)),null!=e&&p(e)});const i=c("#sg-graph-context-menu");u.on("oncontext",function(t){t.event&&t.event.preventDefault();const e=u.getNodeAt(t.pointer.DOM);if(e){u.selectNodes([e]);const a=l.get(e);i.css({left:t.event.clientX+"px",top:t.event.clientY+"px"});const n=e.substr(1).replace(":","-"),o=c("a",i);o.each(function(){const t=c(this);t.hasClass("sg-data-add")?t.attr("href",a.url):t.hasClass("sg-graph-update")?t.attr("href",t.attr("data-href").replaceAll("XXUIDXX",n)):t.hasClass("sg-graph-node-fix")?void 0===a.physics||a.physics?(t.show(),t.attr("data-id",e)):t.hide():t.hasClass("sg-graph-node-unfix")&&(void 0===a.physics||a.physics?t.hide():(t.show(),t.attr("data-id",e)))}),o.click(function(){i.hide()}),i.show()}else u.unselectAll()}),c(document).mousedown(function(t){i.is(":visible")&&!i.is(t.target)&&0===i.has(t.target).length&&i.hide()}),c(".sg-graph-node-fix").click(function(t){var e=c(this).attr("data-id");if(e){const a=l.get(e);a.physics=!1,l.update(a)}t.preventDefault()}),c(".sg-graph-node-unfix").click(function(t){var e=c(this).attr("data-id");if(e){const a=l.get(e);a.physics=!0,l.update(a)}t.preventDefault()})}}function k(){const t=c("#sg-toggle-graph");t.hasClass("active")&&(t.removeClass("active"),c(".fa-project-diagram",t).removeClass("text-danger"),u.storePositions(),c("#sg-graph-container").hide(),c("#sg-control").show(),u.destroy(),s=!1)}function w(){const t=c("#sg-toggle-graph");t.hasClass("active")||(t.addClass("active"),c(".fa-project-diagram",t).addClass("text-danger"),c("#sg-control").hide(),c("#sg-graph-container").show(),b())}function y(t){var e;null!=t?(w(),function(){const t=c("#sg-graph");t.css("background",'url("'+t.attr("data-bg")+'") no-repeat center center')}(),e=c("#sg-graph-container").attr("data-csrf"),c.ajax({url:t,type:"POST",dataType:"json",headers:{"Content-Type":"application/json","X-CSRF-Token":e},data:JSON.stringify({nodes:l.getIds(),edges:d.getIds()}),success:function(t,e,a){c("#sg-graph").css("background","transparent"),null!=t?null==t.error?(null!=t.nodes&&0<t.nodes.length&&l.update(t.nodes),null!=t.edges&&0<t.edges.length&&d.update(t.edges),null!=t.removeNodes&&0<t.removeNodes.length&&l.remove(t.removeNodes),null!=t.removeEdges&&0<t.removeEdges.length&&d.remove(t.removeEdges),null!=t.highlightNode&&(u.unselectAll(),u.selectNodes([t.highlightNode],!1)),u.fit()):alert(t.error):alert("NULL data")}})):alert("Null url!")}function x(){d.clear(),l.clear(),g="",h=""}c.event.special.destroyed={remove:function(t){t.handler&&t.handler()}};let S={};function E(t){t=t||c("body"),c(".sg-geo-result",t).each(function(){var t=c(this);const a=[];if(c(".sg-geo-item",t).each(function(){const t=c(this),n=[];if(c(".sg-geo-point",t).each(function(){const t=c(this);var e=parseFloat(t.attr("data-lat")),a=parseFloat(t.attr("data-lng"));isNaN(e)||isNaN(a)||n.push({lat:e,lng:a,comment:t.html()})}),n.length){const e=c(".sg-geo-title",t);a.push({title:e.html(),url:e.attr("href"),min:t.attr("data-min"),max:t.attr("data-max"),jdMin:parseInt(t.attr("data-min-jd")),jdMax:parseInt(t.attr("data-max-jd")),coordinates:n})}}),a.length){const e=c(".sg-geo-map",t),n=c(".sg-geo-slider",t),o=c(".sg-show-query-map",t);o.removeClass("hidden"),o.on("click",function(){!function(t,e,a){t.removeClass("hidden");const n=L.map(t[0],{doubleClickZoom:!1}).setView([S.lat||0,S.lng||0],S.zoom||1),o=L.tileLayer.provider(S.provider||"Stamen.TerrainBackground",S.options||{});o.addTo(n);const i=L.featureGroup().addTo(n);!function(t,e){for(const a of e)for(const n of a.coordinates){const o=document.createElement("DIV"),i=document.createElement("DIV"),r=document.createElement("STRONG"),s=document.createElement("A");if(s.setAttribute("href",a.url),s.innerText=a.title,r.appendChild(s),i.appendChild(r),o.appendChild(i),s.addEventListener("click",function(t){p(a.url),t.preventDefault()}),a.min&&"---"!==a.min||a.max&&"---"!==a.max){let t="";t=a.min===a.max?a.min:"---"!==a.min&&"---"!==a.max?a.min+" – "+a.max:"---"!==a.min?a.min+" – ":" – "+a.max;const d=document.createElement("DIV");d.innerText=t,o.appendChild(d)}if(n.comment){const c=document.createElement("DIV");c.innerText=n.comment,o.appendChild(c)}const l=L.marker([n.lat,n.lng],{title:a.title,from:a.jdMin,to:a.jdMax}).addTo(t);l.bindPopup(o)}}(i,a);const r=i.getBounds();r.isValid()&&(n.fitBounds(r.pad(.05)),13<n.getZoom()&&n.setZoom(13));let s=1e7,l=0;const d=[],c={0:"-∞",1e7:"+∞"};for(const h of a)0!==h.jdMin&&(h.jdMin<s&&(s=h.jdMin),-1===d.indexOf(h.jdMin)&&(d.push(h.jdMin),c[h.jdMin]=h.min)),1e7!==h.jdMax&&(h.jdMax>l&&(l=h.jdMax),-1===d.indexOf(h.jdMax)&&(d.push(h.jdMax),c[h.jdMax]=h.max));if(1e7!==s||0!==l){1e7===s&&(s=l),0===l&&(l=s),d.sort(function(t,e){return t-e});const g={min:0};for(let t=0;t<d.length;t++){var u=Math.round(1e4/(d.length+1))/100*(t+1)+"%";g[u]=d[t]}g.max=1e7,e.removeClass("hidden"),noUiSlider.create(e[0],{start:[0,1e7],connect:!0,range:g,snap:!0,tooltips:[{to:function(t){return c[t]||t}},{to:function(t){return c[t]||t}}]}),e[0].noUiSlider.on("slide",function(t){const e=parseInt(t[0]),a=parseInt(t[1]);i.eachLayer(function(t){t.options.from>a||t.options.to<e?(t.getElement().style.display="none",t.closePopup()):t.getElement().style.display="block"})})}}(e,n,a),c(this).remove()})}})}c(document).ready(function(){c("#sg-close-all").click(function(t){c(".sg-data").fadeOut("fast",function(){c(this).remove()}),t.preventDefault()}),c(".sg-locale").click(function(t){c.get(c(this).attr("href"),function(t){var e=c("#sg-base").html();""!==t&&(window.location.href=e)}).fail(function(){alert("ERROR")}),t.preventDefault()}),c("#sg-toggle-graph").click(function(t){(c(this).hasClass("active")?k:w)(),t.preventDefault()}),c(".sg-graph-action-remove").click(function(t){var e=u.getSelection();0<e.edges.length&&d.remove(e.edges),0<e.nodes.length&&l.remove(e.nodes),t.preventDefault()}),c("#sg-graph-action-restart").click(function(t){x(),t.preventDefault()}),c("#sg-graph-action-reload").click(function(t){u.destroy(),s=!1,b(),c.post(c(this).attr("href"),{_csrf:c("#sg-graph-container").attr("data-csrf"),data:JSON.stringify({nodes:l.getIds(),edges:d.getIds()})},function(e){if(e&&e.nodes&&e.nodes.length)for(let t=0;t<e.nodes.length;t++){var a=l.get(e.nodes[t].id);a&&(a.physics||(e.nodes[t].physics=!1),e.nodes[t].x=a.x,e.nodes[t].y=a.y)}l.clear(),d.clear(),l.update(e.nodes),d.update(e.edges)}).fail(function(){alert("ERROR")}),t.preventDefault()}),c("#sg-graph-action-fit").click(function(t){u.fit(),t.preventDefault()}),c("#sg-graph-close").click(function(t){k(),t.preventDefault()}),c("#sg-graph-action-load").click(function(t){c("#sg-graph-modal-load").modal(),t.preventDefault()}),c("#sg-graph-toggle-physics").click(function(t){v=!v,c(this).html(v?'<i class="fa fa-snowflake"></i>':'<i class="fa fa-magnet"></i>'),l.forEach(function(t){t.physics=v,l.update(t)}),t.preventDefault()}),c("#sg-graph-action-save").click(function(t){if(0<l.length){c("#title-sg-graph-save").val(null!==h?h:"");const e=c("#save-as-new-sg-graph-save").parent().parent().parent();null!==g?e.show():e.hide(),c("#sg-graph-modal-save").modal()}t.preventDefault()}),c("#sg-graph-modal-load").on("shown.bs.modal",function(){const n=c(this),o=c(".modal-body",n);o.html(c("#sg-wait").html());var t=n.attr("data-url");c.get(t,function(t){let e=n.attr("data-get-url"),a="";t.forEach(function(t){a+="<li><a href='"+e+t.uid+"' data-uid='"+t.uid+"'>"+t.title+"</a></li>"}),""!=a&&(a="<ul>"+a+"</ul>"),o.html(a),c("a",o).click(function(t){x(),y(c(this).attr("href")),h=c(this).html(),g=c(this).attr("data-uid"),n.modal("hide"),t.preventDefault()})})}),c("#sg-graph-modal-save-frm").submit(function(t){t.preventDefault();const e=c("#title-sg-graph-save").val();let a=g;null!=g&&c("#save-as-new-sg-graph-save").is(":checked")&&(a=null),u.storePositions();const n=[],o=[];l.forEach(function(t){n.push({id:t.id,x:t.x,y:t.y,group:t.group,physics:t.physics})}),d.forEach(function(t){o.push({id:t.id,group:t.group})});c.post(c(this).attr("action"),{_csrf:c("#sg-graph-container").attr("data-csrf"),uid:a,title:e,type:"graph",data:JSON.stringify({nodes:n,edges:o})},function(t){h=e,g=t}).fail(function(){alert("ERROR")}),c("#sg-graph-modal-save").modal("hide")});var t=c("#sg-map-settings").html();t&&(S=JSON.parse(t),S&&afterAjaxHooks.push(E)),m(c("body"))})}(jQuery);
