!function(m){let n;function e(t){t=t||m("body"),m(".sg-geotab",t).on("shown.bs.tab",function(t){const e=m(t.target);if("1"!=e.attr("data-created")){e.attr("data-created","1");const o=e.attr("data-locations-id"),r=m("#"+o),l=m(".sg-map-form",r),s=m(".sg-geocomplete",l);let i=m("#"+o+"-markers",r);const d=L.map(o+"-map").setView([n.lat||0,n.lng||0],n.zoom||1),a=L.tileLayer.provider(n.provider||"Stamen.TerrainBackground",n.options||{});a.addTo(d);const c=L.featureGroup().addTo(d);p(i,c,d),m(".sg-map-add-marker",r).click(function(t){m(this).parent().hide(),l.show(),t.preventDefault()}),s.typeahead({hint:!0,highlight:!0,minLength:2},{name:"address-suggest-"+o,displayKey:"title",limit:100,valueKey:"id",source:function(t,e,n){m.ajax({url:"http://nominatim.openstreetmap.org/search?format=json&q="+encodeURIComponent(t)}).done(function(e){const a=[];for(let t=0;t<e.length;t++)a.push({title:e[t].display_name,lng:e[t].lon,lat:e[t].lat});n(a)})},async:!0}).bind("typeahead:selected",function(t,e){s.val(e.title),m("input[name=lat]",l).val(e.lat),m("input[name=lng]",l).val(e.lng),m("input[type=submit]",l).show()}).bind("keyup",function(){this.value||(s.val(""),m("input[name=lat]",l).val(""),m("input[name=lng]",l).val(""),m("input[type=submit]",l).hide())}),l.ajaxForm({beforeSubmit:function(t,e,a){return r.addClass("disabled"),!0},success:function(t,e,a,n){r.removeClass("disabled"),i.replaceWith(t),i=m("#"+o+"-markers",r),p(i,c,d),s.val(""),m("input[name=lat]",l).val(""),m("input[name=lng]",l).val(""),m("input[name=comment]",l).val(""),m("input[type=submit]",l).hide()},error:function(t,e,a,n){r.removeClass("disabled"),alert("Error "+t.status+"\n"+t.statusText)}})}})}function p(t,e,a,n=!0){if(e.clearLayers(),m(".sg-location-marker",t).each(function(){!function(e,a,n,i){const o=parseFloat(e.attr("data-lat")),r=parseFloat(e.attr("data-lng")),t=document.createElement("DIV");var l=e.attr("data-comment");if(void 0!==l&&""!==l){const d=document.createElement("P");d.innerText=l,t.appendChild(d)}if("1"===e.attr("data-delete-ok")){const c=document.createElement("P");t.appendChild(c);const u=document.createElement("BUTTON");u.setAttribute("class","btn btn-danger btn-xs"),u.innerText=m("#sg-delete-text").html(),c.appendChild(u),u.addEventListener("click",function(t){t.preventDefault();t=m("#sg-really-delete-text").html().replace("{0}",o+","+r);confirm(t)&&m.get(e.attr("data-delete"),function(t){var e=a.attr("id");a.replaceWith(t),p(a=m("#"+e),n,i,!1)})})}const s=L.marker([o,r]).addTo(n);s.bindPopup(t)}(m(this),t,e,a)}),n){const i=e.getBounds();i.isValid()&&a.fitBounds(i.pad(.05))}}m(document).ready(function(){var t=m("#sg-map-settings").html();t&&(n=JSON.parse(t),n&&afterAjaxHooks.push(e))})}(jQuery);
