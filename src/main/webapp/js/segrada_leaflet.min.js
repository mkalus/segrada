!function(m){let n;function e(t){t=t||m("body"),m(".sg-geotab",t).on("shown.bs.tab",function(t){const e=m(t.target);if("1"!=e.attr("data-created")){e.attr("data-created","1");const i=e.attr("data-locations-id"),l=m("#"+i),r=m(".sg-map-form",l),s=m(".sg-geocomplete",r);let o=m("#"+i+"-markers",l);const d=L.map(i+"-map",{doubleClickZoom:!1}).setView([n.lat||0,n.lng||0],n.zoom||1),a=L.tileLayer.provider(n.provider||"Stamen.TerrainBackground",n.options||{});a.addTo(d);const c=L.featureGroup().addTo(d);p(o,c,d),m(".sg-map-add-marker",l).click(function(t){m("#"+i+"-add-location-btn").hide(),r.show(),t.preventDefault()}),s.typeahead({hint:!0,highlight:!0,minLength:2},{name:"address-suggest-"+i,displayKey:"title",limit:100,valueKey:"id",source:function(t,e,n){m.ajax({url:"http://nominatim.openstreetmap.org/search?format=json&q="+encodeURIComponent(t)}).done(function(e){const a=[];for(let t=0;t<e.length;t++)a.push({title:e[t].display_name,lng:e[t].lon,lat:e[t].lat});n(a)})},async:!0}).bind("typeahead:selected",function(t,e){s.val(e.title),m("input[name=lat]",r).val(e.lat),m("input[name=lng]",r).val(e.lng),m("input[type=submit]",r).show()}).bind("keyup",function(){this.value||(s.val(""),m("input[name=lat]",r).val(""),m("input[name=lng]",r).val(""),m("input[type=submit]",r).hide())}),r.ajaxForm({beforeSubmit:function(t,e,a){return l.addClass("disabled"),!0},success:function(t,e,a,n){l.removeClass("disabled"),o.replaceWith(t),o=m("#"+i+"-markers",l),p(o,c,d),s.val(""),m("input[name=lat]",r).val(""),m("input[name=lng]",r).val(""),m("input[name=comment]",r).val(""),m("input[type=submit]",r).hide()},error:function(t,e,a,n){l.removeClass("disabled"),alert("Error "+t.status+"\n"+t.statusText)}}),d.on("dblclick",function(t){return m("#"+i+"-add-location-btn").hide(),r.show(),m("input[name=lat]",r).val(t.latlng.lat),m("input[name=lng]",r).val(t.latlng.lng),m("input[type=submit]",r).show(),!1})}})}function p(t,e,a,n=!0){if(e.clearLayers(),m(".sg-location-marker",t).each(function(){!function(e,a,n,o){const i=parseFloat(e.attr("data-lat")),l=parseFloat(e.attr("data-lng")),t=document.createElement("DIV");var r=e.attr("data-comment");if(void 0!==r&&""!==r){const d=document.createElement("P");d.innerText=r,t.appendChild(d)}if("1"===e.attr("data-delete-ok")){const c=document.createElement("P");t.appendChild(c);const u=document.createElement("BUTTON");u.setAttribute("class","btn btn-danger btn-xs"),u.innerText=m("#sg-delete-text").html(),c.appendChild(u),u.addEventListener("click",function(t){t.preventDefault();t=m("#sg-really-delete-text").html().replace("{0}",i+","+l);confirm(t)&&m.get(e.attr("data-delete"),function(t){var e=a.attr("id");a.replaceWith(t),p(a=m("#"+e),n,o,!1)})})}const s=L.marker([i,l]).addTo(n);s.bindPopup(t)}(m(this),t,e,a)}),n){const o=e.getBounds();o.isValid()&&(a.fitBounds(o.pad(.05)),13<a.getZoom()&&a.setZoom(13))}}m(document).ready(function(){var t=m("#sg-map-settings").html();t&&(n=JSON.parse(t),n&&afterAjaxHooks.push(e))})}(jQuery);
